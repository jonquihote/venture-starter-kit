import:
  - recipe/laravel.php

config:
  repository: 'git@github.com:jonquihote/venture-starter-kit.git'
  application: 'www.venture.com'
  branch: main
  remote_user: forge
  base_deploy_path: '/home/forge'
  keep_releases: 5

hosts:
  prod:
    hostname: venture
    deploy_path: '{{base_deploy_path}}/{{application}}'

tasks:
  aeon:bootstrap:authorization:
    - run: 'cd {{release_or_current_path}} && php artisan aeon:bootstrap:authorization'
  filament:optimize:
    - run: 'cd {{release_or_current_path}} && php artisan filament:optimize'
  bun:install:
    - run: 'cd {{release_or_current_path}} && bun install'
  bun:run:build:
    - run: 'cd {{release_or_current_path}} && bun run build'

after:
  deploy:failed: deploy:unlock

before:
  deploy:publish:
    - aeon:bootstrap:authorization
    - bun:install
    - bun:run:build
    - artisan:optimize
    - filament:optimize
    - artisan:horizon:terminate
    - artisan:pulse:restart
    - artisan:reverb:restart
